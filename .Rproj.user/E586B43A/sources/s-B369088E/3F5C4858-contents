---
title: "STUDY 2: BLACK CHURCH"
output: html_notebook
---

# STUDY 2: BLACK CHURCH

## Import data

```{r}
# Load packages
library(foreign) # for importing .sav files
library(lme4) # for MLM analysis with lmer function
library(sjstats) # Companion functions for lme4 package allowing for estimation of ICC, R^2, Fixed effect p-values,
library(lmerTest) # Test random components with ranova() function of this package
library(nlme) # for MLM analysis with lme function

# Import data
rel <- read.csv("/Users/Professional/Documents/Research Resources/Reserach Projects/*Completed Studies/Religiousness-Attitudes on Homosexuality/Data/Final Final Dataset.csv", header=TRUE)

# REMOVE participants
rel <- subset(rel, Participant != 194)  # This person has missing data on all items

```

## Recode variable

```{r}
# Load package for group mean centering
library(dplyr)

# Recode 
rel$EthnicityBW = as.numeric(as.character(recode(rel$Ethnicity, 
  "1" = 0,  
  "7" = 1)))

# Recode Ethnicity (0 = POC vs 1 = White)
rel$EthnicityPW = as.numeric(as.character(recode(rel$Ethnicity, 
  "1" = 0,
  "3" = 0,
  "4" = 0,
  "6" = 0,
  "7" = 1,
  "8" = 0)))

# Recode Prev_Couns (0 = No; 1 = Yes)
rel$Prev_Couns = as.numeric(as.character(recode(rel$Prev_Couns, 
  "1" = 1,  
  "2" = 0,
  "7" = 1)))

# Recode Age 
rel$Age <- as.numeric(dplyr::case_when(rel$Age == "> 50" ~ "50",
                                       rel$Age == "> 60" ~ "60",
                                       TRUE ~ as.character(rel$Age)))

# Recode Education (0 = No college degree; 1 = In college/Has college degree)
rel$edu_cat = as.numeric(as.character(recode(rel$Education, 
  "1" = 0,  
  "2" = 0,
  "3" = 1,
  "4" = 0,
  "5" = 1,
  "6" = 1)))

# Recode Education (0 = No college degree; 1 = In college/Has college or technical degree)
rel$edu_cat2 = as.numeric(as.character(recode(rel$Education, 
  "1" = 0,  
  "2" = 0,
  "3" = 1,
  "4" = 1,
  "5" = 1,
  "6" = 1)))

# Recode sexual orientation (1 = heterosexual; 0 = not heterosexual)
rel$sorien = as.numeric(as.character(recode(rel$Sexuality, 
  "1" = 0,  
  "2" = 1,
  "3" = 1,
  "4" = 1,  
  "5" = 1)))

# Reverse code orthodoxy variable
rel$Scrip_Int = as.numeric(as.character(recode(rel$Scrip_Int, 
  "1" = 3,  
  "1.5" = 1,
  "2" = 2,
  "3" = 1)))

# Recode Orthody Variable into binary variable
rel$Scrip_Int = as.numeric(as.character(recode(rel$Scrip_Int, 
  "1" = 1,  
  "2" = 1,
  "3" = 2)))
  # Dummy code orthodoxy variable
  #rel$Scrip_Int_12 = as.numeric(as.character(recode(rel$Scrip_Int, "1" = 0,  "2" = 1,"3" = 0)))
  #rel$Scrip_Int_13 = as.numeric(as.character(recode(rel$Scrip_Int, "1" = 0,  "2" = 0,"3" = 1)))

# Recode LGBTQ_Mem variable into binary due to extreme skewness and kurtosis
  rel$LGBTQ_MemBin = ifelse(rel$LGBTQ_Mem == 0, 0, 1)
  
# Create average composite variablew for ATH
rel$ATH <- as.numeric(rowMeans(rel[,c("Disgusting","Perversion","Nat_Express","Wrong","Diff_Life","Fit_In","Law_Abol","Sin","No_Problem","Sick")], na.rm = TRUE))

```

## Filter Data

```{r}

# Create subset of data with only Black and White participants (n =219)
rel2 <- subset(rel, Ethnicity=="1")

# CENTER VARIABLES

# GROUP-MEAN-CENTERING (WITHIN-GROUP)
  library(robumeta)
  # Religious Attendance Frequency
    rel2$Rel_AttendW <- as.numeric(group.center(rel2$Rel_Attend, rel2$Con_No)) 
  # Scripture Reading Freqeuency
    rel2$Scrip_ReadW <- as.numeric(group.center(rel2$Scrip_Read, rel2$Con_No)) 
  # Scripture Interpretation Adherence
    rel2$Scrip3W <- as.numeric(group.center(rel2$Scrip3, rel2$Con_No)) 
  # Religiousness
    rel2$ReligiousnessW <- as.numeric(group.center(rel2$Religiousness, rel2$Con_No)) 
  # CongAffirm
    rel2$CongAffirmW <- as.numeric(group.center(rel2$CongAffirm, rel2$Con_No))
  # Rel_Attend
    rel2$Rel_AttendW <- as.numeric(group.center(rel2$Rel_Attend, rel2$Con_No)) 
  # LGBTQ_Mem
    rel2$LGBTQ_MemW <- as.numeric(group.center(rel2$LGBTQ_Mem, rel2$Con_No)) 
  # EthnicityBW (0 = Black, 1 = White)
    rel2$EthnicityBW_W <- as.numeric(group.center(rel2$EthnicityBW, rel2$Con_No))    
  # EthnicityPW (0 = POC, 1 = White)
    rel2$EthnicityPWW <- as.numeric(group.center(rel2$EthnicityPW, rel2$Con_No))   
  # Minority (0 = not minoirty in congregation, 1 = minority in congregation))
    rel2$MinorityW <- as.numeric(group.center(rel2$Minority, rel2$Con_No))   
  # Gender (0 = women, 1 = men)
    rel2$GenderW <- as.numeric(group.center(rel2$Gender, rel2$Con_No))   
  # Education
    rel2$EducationW <- as.numeric(group.center(rel2$Education, rel2$Con_No))  
  # Education (0 = No college degree; 1 = In college/Has college degree)
    rel2$edu_catW <- as.numeric(group.center(rel2$edu_cat, rel2$Con_No))  
  # Education (0 = No college degree; 1 = In college/Has college or technical degree)
    rel2$edu_cat2W <- as.numeric(group.center(rel2$edu_cat2, rel2$Con_No))  
  # Percentage
    rel2$PercentageW <- as.numeric(group.center(rel2$Percentage, rel2$Con_No)) 
  # Discuss_Cont (Congregation Discussed MH, continous variable)
    rel2$Discuss_ContW <- as.numeric(group.center(rel2$Discuss_Cont, rel2$Con_No)) 
  # Discuss_Cat (Congregation Discussed MH, categorical variable)
    rel2$Discuss_CatW <- as.numeric(group.center(rel2$Discuss_Cat, rel2$Con_No))     
  # Prog_Cont
    rel2$Prog_ContW <- as.numeric(group.center(rel2$Prog_Cont, rel2$Con_No))   
  # Treat_Att
    rel2$Treat_AttW <- as.numeric(group.center(rel2$Treat_Att, rel2$Con_No))  
  # Previous Counseling (Prev_Couns)
    rel2$Prev_CounsW <- as.numeric(group.center(rel2$Prev_Couns, rel2$Con_No))  
  # TS_Scaled (Barriers to treatment)
    rel2$TS_ScaledW <- as.numeric(group.center(rel2$TS_Scaled, rel2$Con_No))      
  # Age
    rel2$AgeW <- as.numeric(group.center(rel2$Age, rel2$Con_No))    
  # ATH_Scaled (Negative attitudes towards homosexuality)
    rel2$ATH_ScaledW <- as.numeric(group.center(rel2$ATH_Scaled, rel2$Con_No))       
  # sexual orientation (1 = heterosexual; 0 = not heterosexual)
    rel2$sorienW <- as.numeric(group.center(rel2$sorien, rel2$Con_No))
     
# GROUP MEAN CENTERED ON GRAND MEAN (BETWEEN-GROUP)
  # Religious Attendance Frequency
    rel2$Rel_AttendB <- as.numeric(group.mean(rel2$Rel_Attend, rel2$Con_No)-mean(rel2$Rel_Attend, na.rm=TRUE))  
  # Scripture Reading Freqeuency
    rel2$Scrip_ReadB <- as.numeric(group.mean(rel2$Scrip_Read, rel2$Con_No)-mean(rel2$Scrip_Read, na.rm=TRUE))  
  # Scripture Interpretation Adherence
    rel2$Scrip3B <- as.numeric(group.mean(rel2$Scrip3, rel2$Con_No)-mean(rel2$Scrip3, na.rm=TRUE))    
  # Religiousness    
    rel2$ReligiousnessB <- as.numeric(group.mean(rel2$Religiousness, rel2$Con_No)-mean(rel2$Religiousness, na.rm=TRUE))  
  # CongAffirm    
    rel2$CongAffirmB <- as.numeric(group.mean(rel2$CongAffirm, rel2$Con_No)-mean(rel2$CongAffirm, na.rm=TRUE)) 
  # Rel_Attend    
    rel2$Rel_AttendB <- as.numeric(group.mean(rel2$Rel_Attend, rel2$Con_No)-mean(rel2$Rel_Attend, na.rm=TRUE))  
  # LGBTQ_Mem    
    rel2$LGBTQ_MemB <- as.numeric(group.mean(rel2$LGBTQ_Mem, rel2$Con_No)-mean(rel2$LGBTQ_Mem, na.rm=TRUE)) 
  # EthnicityBW (0 = Black, 1 = White)    
    rel2$EthnicityBW_B <- as.numeric(group.mean(rel2$EthnicityBW, rel2$Con_No)-mean(rel2$EthnicityBW, na.rm=TRUE))
  # EthnicityPW (0 = POC, 1 = White)    
    rel2$EthnicityPWB <- as.numeric(group.mean(rel2$EthnicityPW, rel2$Con_No)-mean(rel2$EthnicityPW, na.rm=TRUE))
  # Minority (0 = not minoirty in congregation, 1 = minority in congregation)
    rel2$MinorityB <- as.numeric(group.mean(rel2$Minority, rel2$Con_No)-mean(rel2$Minority, na.rm=TRUE))  
  # Gender    
    rel2$GenderB <- as.numeric(group.mean(rel2$Gender, rel2$Con_No)-mean(rel2$Gender, na.rm=TRUE))
  # Education    
    rel2$EducationB <- as.numeric(group.mean(rel2$Education, rel2$Con_No)-mean(rel2$Education, na.rm=TRUE))  
  # Education (0 = No college degree; 1 = In college/Has college degree)
    rel2$edu_catB <- as.numeric(group.mean(rel2$edu_cat, rel2$Con_No)-mean(rel2$edu_cat, na.rm=TRUE))  
  # Education (0 = No college degree; 1 = In college/Has college or technical degree)
    rel2$edu_cat2B <- as.numeric(group.mean(rel2$edu_cat2, rel2$Con_No)-mean(rel2$edu_cat2, na.rm=TRUE))      
  # Percentage    
    rel2$PercentageB <- as.numeric(group.mean(rel2$Percentage, rel2$Con_No)-mean(rel2$Percentage, na.rm=TRUE))   
  # Discuss_Cont    
    rel2$Discuss_ContB <- as.numeric(group.mean(rel2$Discuss_Cont, rel2$Con_No)-mean(rel2$Discuss_Cont, na.rm=TRUE))
  # Discuss_Cat  
    rel2$Discuss_CatB <- as.numeric(group.mean(rel2$Discuss_Cat, rel2$Con_No)-mean(rel2$Discuss_Cat, na.rm=TRUE))    
  # Prog_Cont    
    rel2$Prog_ContB <- as.numeric(group.mean(rel2$Prog_Cont, rel2$Con_No)-mean(rel2$Prog_Cont, na.rm=TRUE))
  # Treat_Att    
    rel2$Treat_AttB <- as.numeric(group.mean(rel2$Treat_Att, rel2$Con_No)-mean(rel2$Treat_Att, na.rm=TRUE))
  # Previous Counseling (Prev_Couns)    
    rel2$Prev_CounsB <- as.numeric(group.mean(rel2$Prev_Couns, rel2$Con_No)-mean(rel2$Prev_Couns, na.rm=TRUE))  
  # TS_Scaled (Barriers to treatment)    
    rel2$TS_ScaledB <- as.numeric(group.mean(rel2$TS_Scaled, rel2$Con_No)-mean(rel2$TS_Scaled, na.rm=TRUE))  
  # Age
    rel2$AgeB <- as.numeric(group.mean(rel2$Age, rel2$Con_No)-mean(rel2$Age, na.rm=TRUE))      
  # ATH_Scaled (Negative attitudes towards homosexuality)    
    rel2$ATH_ScaledB <- as.numeric(group.mean(rel2$ATH_Scaled, rel2$Con_No)-mean(rel2$ATH_Scaled, na.rm=TRUE))  
  # sexual orientation (1 = heterosexual; 0 = not heterosexual)
    rel2$sorienB <- as.numeric(group.mean(rel2$sorien, rel2$Con_No)-mean(rel2$sorien, na.rm=TRUE)) 

# Subset data to include cases with no missing data (new sample size = 181)
rel2 <- subset(rel2, GenderW > -50) # Include only those with all data on gender
rel2 <- subset(rel2, AgeW > -50) # Include only those with all data on gender
rel2 <- subset(rel2, EducationW > -50) # Include only those with all data on gender
rel2 <- subset(rel2, ReligiousnessW > -50) # Include only those with all data on Discuss_ContW
#rel2 <- subset(rel2, PercentageB > -20) # Include only those with all data on Discuss_ContW
   
```

## Preliminary Analysis

### Check Outliers

```{r}
# Scores greater than |z| = 3 is are outliers
#rel2$ATH_ScaledWz <- scale(rel2$ATH_ScaledW, center = TRUE, scale = TRUE)
#rel2$AgeWz <- scale(rel2$AgeW, center = TRUE, scale = TRUE)
#rel2$ReligiousnessWz <- scale(rel2$ReligiousnessW, center = TRUE, scale = TRUE)

#rel2$ATH_ScaledBz <- scale(rel2$ATH_ScaledB, center = TRUE, scale = TRUE)
#rel2$AgeBz <- scale(rel2$AgeB, center = TRUE, scale = TRUE)
#rel2$ReligiousnessBz <- scale(rel2$ReligiousnessB, center = TRUE, scale = TRUE)
#rel2$PercentageBz <- scale(rel2$PercentageB, center = TRUE, scale = TRUE)

table(rel2$ATH_ScaledWz) # has 1 participant outlier (Participant = 245, z = -3.547173762)
table(rel2$AgeWz) # Has participant 0 outlier
table(rel2$ReligiousnessWz) # Has 1 participant outlier (Participant = 47, z = -3.02246687)
table(rel2$ATH_ScaledBz) # has 0 outlier
table(rel2$AgeBz) # has 1 outlier (Congregation = 11, z = -3.1284974)
table(rel2$ReligiousnessBz) # Has 1 outlier (Congregation = 18, z = -4.61169425)
table(rel2$PercentageBz) # Has 1 outlier (Congregation = 11, z = -7.8814286)

View(rel2[,c("Participant","Congregation","Con_No","ATH_ScaledWz","AgeWz","ReligiousnessWz","ATH_ScaledBz","AgeBz","ReligiousnessBz","Percentage","PercentageB","PercentageBz")])

# Remove participants/congregations with outliers
rel2_NoOutlier <- rel2 # Make no dataset to remove outliers
rel2_NoOutlier <- subset(rel2_NoOutlier, Participant!=245)
rel2_NoOutlier <- subset(rel2_NoOutlier, Participant!=47)
rel2_NoOutlier <- subset(rel2_NoOutlier, Con_No!=11)
rel2_NoOutlier <- subset(rel2_NoOutlier, Con_No!=18)

# Compute Level 1: Mean and SD
  psych::describe(rel2[,c("ATH","Gender","Age", "Education","Rel_Attend")])
# Compute Leve 2: Mean and SD
  # Create Variable for Group Mean
  library(robumeta)
  rel2$ATH_GM <- as.numeric(group.mean(rel2$ATH, rel2$Con_No)) 
  rel2$Gender_GM <- as.numeric(group.mean(rel2$Gender, rel2$Con_No)) 
  rel2$Age_GM <- as.numeric(group.mean(rel2$Age, rel2$Con_No)) 
  rel2$Education_GM <- as.numeric(group.mean(rel2$Education, rel2$Con_No)) 
  rel2$Rel_Attend_GM <- as.numeric(group.mean(rel2$Rel_Attend, rel2$Con_No)) 
  rel2$Percentage_GM <- as.numeric(group.mean(rel2$Percentage, rel2$Con_No)) 
  # Create new dataset with 1 row per group
  relB <- rel2[!duplicated(rel2$Con_No), ] 
  psych::describe(relB[,c("ATH_GM","Gender_GM","Age_GM","Education_GM","Rel_Attend_GM","Percentage_GM")])
```


### Cronbach's Alpha

```{r}
PerformanceAnalytics::chart.Correlation(rel2[c("Rel_Attend", "Scrip_Read", "Scrip3")])

# Reverse score Scripture Adherence variable 
rel2$ScripRev <- 4-rel2$Scrip_Int

#psych::alpha(rel[,c("Rel_Attend","Scrip_Read","Scrip3")])
psych::alpha(rel2[,c("Rel_Attend","Scrip_Read","Scrip3")])
psych::alpha(rel2[,c("Rel_Attend","Scrip_Read")])
psych::alpha(rel2[,c("Rel_Attend","Scrip3")])
psych::alpha(rel2[,c("Scrip_Read","Scrip3")])
```


### Correlation Matrix

```{r}
# correlation matrix
PerformanceAnalytics::chart.Correlation(rel2[,c("Rel_Attend","Scrip_Read","Scrip3")])

# Single Level Correlation Matrix
apaTables::apa.cor.table(rel2[c(
"ATH", "Gender","Age", "Education", "Minority", "Religiousness", "Percentage")], show.conf.interval = FALSE, landscape = TRUE, table.number = 1, filename="CorMatrix.doc")

# Multilevel Correlation Matrix
apaTables::apa.cor.table(rel2[c(
"ATHW","GenderW","AgeW", "EducationW","Rel_AttendW",
"ATHB","GenderB","AgeB", "EducationB","Rel_AttendB","PercentageB")], show.conf.interval = FALSE, landscape = TRUE, table.number = 1, filename="CorMatrix.doc")
```


### ICC

RESULTS:
* EthnicityBW:
  ** L1 variance: 0.008926
  ** L2 variance: 0.186522
  ** ICC: 0.186522/(0.186522+0.008926) = 0.9543

* Religiousness:
  ** L1 variance: 12.290
  ** L2 variance: 6.686
  ** ICC: (6.686)/(6.686+12.290) = 0.352

* CongAffirm:
  ** L1 variance: 2.653
  ** L2 variance: 3.781
  ** ICC: (3.781)/(3.781+2.653) = 0.5876
  
* Minority:
  ** L1 variance: 0.006505
  ** L2 variance: 0.091626
  ** ICC: (0.091626)/(0.091626+0.006505) = 0.9337  
  
## Main Analysis

V001a = Model predicting homonegative attitudes from 3 item religiousness (as one variable) and demographics variables. With all outliers included.

V001b = Model predicting homonegative attitudes from 3 item religiousness (as one variable) and demographics variables. With outliers removed (5 participants, 2 congregations)

V002 = Model predicting homonegative attitudes from religious attendance attendance, scripture adherence, and demographics variables

V003 = Model predicting homonegative attitudes from religious attendance attendance only. [THIS ANALYSIS WAS USED IN FINAL MANUSCRIPT]

V004 = Model predicting homonegative attitudes from scripture adherence (orthodoxy) only. 

V005 = Model predicting homonegative attitudes from Frequency of Reading Scripture Only

V006 = Model predicting homonegative attitudes from 3 separate variables of religiousness (religious attendance frequency, religious reading frequency, and adherence to religious text)

V007 = Model predicting homonegative attitudes from religious attendance attendance and scripture interpretation only.

V008 = Model predicting homonegative attitudes from religious attendance attendance and scripture reading frequency only.

V009 = Model predicting homonegative attitudes from scritpure reading frequency and scripture interpretation only.

V010 =  Model predicting ATH from all significant correlations between study variables. This includes: Rel_AttendW, Scrip_ReadW, GenderB, EducationB, PercentageB, Rel_AttendB, Scrip_ReadB, Scrip3B

V011 =  Model predicting ATH from all significant correlations between study variables (except scripture interpretation). This includes: Rel_AttendW, Scrip_ReadW, GenderB, EducationB, PercentageB, Rel_AttendB, Scrip_ReadB.

three indicators of religiousness and all of the demographics, minus age,

### V001a


```{r}
# MODEL 1
  m1 <- lmer(ATH ~ 1 + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m1)
  AIC(m1) # request AIC
  BIC(m1) # request BIC
  mb1 <- lme(ATH_Scaled ~ 1, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb1)
  anova(mb1) # request F-tests for fixed effects
  ranova(m1) # request test of random effects
  confint(m1) # request test of random effects (variance displayed as SD)

# MODEL 2
  m2 <- lmer(ATH_Scaled ~ GenderW + AgeW + EducationW + ReligiousnessW + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m2)
  AIC(m2) # request AIC
  BIC(m2) # request BIC
  mb2 <- lme(ATH_Scaled ~ GenderW + AgeW + EducationW + ReligiousnessW, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb2)
  anova(m2) # request F-tests for fixed effects
  ranova(m2) # request test of random effects
  confint(m2) # request test of random effects (variance displayed as SD)
  #anova(mb1, mb2) 

# MODEL 3
  m3 <- lmer(ATH_Scaled ~ GenderW + AgeW + EducationW + ReligiousnessW + GenderB + AgeB + EducationB + ReligiousnessB + PercentageB + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m3)
  AIC(m3) # request AIC
  BIC(m3) # request BIC
  mb3 <- lme(ATH_Scaled ~ GenderW + AgeW + EducationW + ReligiousnessW + GenderB + AgeB + EducationB + ReligiousnessB + PercentageB + ReligiousnessW*EducationB, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb3)
  anova(m3) # request F-tests for fixed effects
  ranova(m3) # request test of random effects
  confint(m3) # request test of random effects (variance displayed as SD)
  #anova(m1, m3)
  #anova(m2, m3)

# MODEL 4
  m4 <- lmer(ATH_Scaled ~ GenderW + AgeW + EducationW + ReligiousnessW + GenderB + AgeB + EducationB + ReligiousnessB + PercentageB + ReligiousnessW*EducationB + ReligiousnessB*EducationB + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m4)
  AIC(m4) # request AIC
  BIC(m4) # request BIC
  mb4 <- lme(ATH_Scaled ~ GenderW + AgeW + EducationW + ReligiousnessW + GenderB + AgeB + EducationB + ReligiousnessB + PercentageB + ReligiousnessW*EducationB + ReligiousnessB*EducationB, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb4)
  anova(m4) # request F-tests for fixed effects
  ranova(m4) # request test of random effects
  confint(m4) # request test of random effects (variance displayed as SD)

# For producing APA formatted tables
sjPlot::tab_model(m4, file="APAtable.doc", show.aic=TRUE, show.dev=TRUE, show.obs=FALSE, p.style="asterisk", show.se=TRUE)
  
```

### V001b

```{r}
# MODEL 1
  m1 <- lmer(ATH_Scaled ~ 1 + (1 | Con_No), REML=FALSE, data = rel2_NoOutlier)
  summary(m1)
  AIC(m1) # request AIC
  BIC(m1) # request BIC
  mb1 <- lme(ATH_Scaled ~ 1, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2_NoOutlier)
  summary(mb1)
  anova(mb1) # request F-tests for fixed effects
  ranova(m1) # request test of random effects
  confint(m1) # request test of random effects (variance displayed as SD)

# MODEL 2
  m2 <- lmer(ATH_Scaled ~ GenderW + AgeW + EducationW + ReligiousnessW + (1 | Con_No), REML=FALSE, data = rel2_NoOutlier)
  summary(m2)
  AIC(m2) # request AIC
  BIC(m2) # request BIC
  mb2 <- lme(ATH_Scaled ~ GenderW + AgeW + EducationW + ReligiousnessW, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2_NoOutlier)
  summary(mb2)
  anova(m2) # request F-tests for fixed effects
  ranova(m2) # request test of random effects
  confint(m2) # request test of random effects (variance displayed as SD)
  anova(mb1, mb2)

# MODEL 3
  m3 <- lmer(ATH_Scaled ~ GenderW + AgeW + EducationW + ReligiousnessW + GenderB + AgeB + EducationB + ReligiousnessB + PercentageB + (1 | Con_No), REML=FALSE, data = rel2_NoOutlier)
  summary(m3)
  AIC(m3) # request AIC
  BIC(m3) # request BIC
  mb3 <- lme(ATH_Scaled ~ GenderW + AgeW + EducationW + ReligiousnessW + GenderB + AgeB + EducationB + ReligiousnessB + PercentageB + ReligiousnessW*EducationB, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2_NoOutlier)
  summary(mb3)
  anova(m3) # request F-tests for fixed effects
  ranova(m3) # request test of random effects
  confint(m3) # request test of random effects (variance displayed as SD)
  anova(m1, m3)
  anova(m2, m3)

# MODEL 4
  m4 <- lmer(ATH_Scaled ~ GenderW + AgeW + EducationW + ReligiousnessW + GenderB + AgeB + EducationB + ReligiousnessB + PercentageB + ReligiousnessW*EducationB + ReligiousnessB*EducationB + (1 | Con_No), REML=FALSE, data = rel2_NoOutlier)
  summary(m4)
  AIC(m4) # request AIC
  BIC(m4) # request BIC
  mb4 <- lme(ATH_Scaled ~ GenderW + AgeW + EducationW + ReligiousnessW + GenderB + AgeB + EducationB + ReligiousnessB + PercentageB + ReligiousnessW*EducationB + ReligiousnessB*EducationB, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2_NoOutlier)
  summary(mb4)
  anova(m4) # request F-tests for fixed effects
  ranova(m4) # request test of random effects
  confint(m4) # request test of random effects (variance displayed as SD)

sjPlot::tab_model(m1, m2, m3, m4, file="APAtable.doc", show.aic=TRUE, show.dev=TRUE, show.obs=FALSE, p.style="asterisk", show.se=TRUE)    
```

### V003 [Final Model] **

```{r}
# MODEL 1: EMPTY MODEL
  m1 <- lmer(ATH ~ 1 + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m1)
  AIC(m1) # request AIC
  BIC(m1) # request BIC
  mb1 <- lme(ATH ~ 1, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb1)
  anova(mb1) # request F-tests for fixed effects
  ranova(m1) # request test of random effects
  confint(m1) # request test of random effects (variance displayed as SD)
  # Extract Variances to compute R^2
  var_table = as.data.frame(VarCorr(m1))
  m1_var_tot = var_table[1,'vcov'] + var_table[2,'vcov'] # var_table[1,'vcov'] = L1 var; var_table[2,'vcov'] = L2 var;   

# MODEL 2: ADD L1 PREDICTORS
  m2 <- lmer(ATH ~ GenderW + AgeW + EducationW + Rel_AttendW + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m2)
  AIC(m2) # request AIC
  BIC(m2) # request BIC
  mb2 <- lme(ATH ~ GenderW + AgeW + EducationW + Rel_AttendW, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb2)
  anova(m2) # request F-tests for fixed effects
  ranova(m2) # request test of random effects
  confint(m2) # request test of random effects (variance displayed as SD)
  #anova(mb1, mb2)    
  # Extract Variances to compute R^2
  var_table = as.data.frame(VarCorr(m2))
  m2_var_tot = var_table[1,'vcov'] + var_table[2,'vcov'] # var_table[1,'vcov'] = L1 var; var_table[2,'vcov'] = L2 var; 
  
# MODEL 3: ADD L2 PREDICTORS
  m3 <- lmer(ATH ~ GenderW + AgeW + EducationW + Rel_AttendW + GenderB + AgeB + EducationB + Rel_AttendB + PercentageB + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m3)
  AIC(m3) # request AIC
  BIC(m3) # request BIC
  mb3 <- lme(ATH ~ GenderW + AgeW + EducationW + Rel_AttendW + GenderB + AgeB + EducationB + Rel_AttendB + PercentageB, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb3)
  anova(m3) # request F-tests for fixed effects
  ranova(m3) # request test of random effects
  confint(m3) # request test of random effects (variance displayed as SD)
  #anova(m1, m3)
  reghelper::beta(mb3) # Standardized Estimates
  # Extract Variances to compute R^2
  var_table = as.data.frame(VarCorr(m3))
  m3_var_tot = var_table[1,'vcov'] + var_table[2,'vcov'] # var_table[1,'vcov'] = L1 var; var_table[2,'vcov'] = L2 var; 

# Estimate Explained Variance (R^2)  
  1-(m2_var_tot/m1_var_tot) # Variance explained by model 2
  1-(m3_var_tot/m1_var_tot) # Variance explained by model 3
  
# Crate APA formatted tables
sjPlot::tab_model(m1, m2, m3, file="APAtable.doc", show.aic=TRUE, show.dev=TRUE, show.obs=FALSE, p.style="asterisk", show.se=TRUE)  
```
  
#### Power Analysis

#### Assumptions

These assumptions are checked for Model 3 (which includes all L1 and L2 predictors, but not interaction terms)

MLM has 3 assumptions: linearity, homoscedasticity, and normality. Each are tested below.

```{r}
#install.packages("lme4")
#install.packages("ggplot2")
#install.packages("HLMdiag")
#install.packages("DHARMa")
#install.packages("car")

library("lme4")
library("ggplot2")
library("HLMdiag")
library("DHARMa")
library("car") #for the Levene test which we will not discuss here
library("Matrix")
```

##### Linearity

Assumption 1: Linearity

A regression analysis is meant to fit the best rectilinear line that explains the most data given your set of parameters. Therefore, the base models rely on the assumption that your data follows a straight line (though the models can be expanded to handle curvilinear data). How do you test this assumption?

Graphically, plotting the model residuals (the difference between the observed value and the model-estimated value) vs the predictor is one simple way to test. If a pattern emerges (anything that looks non-random), a higher order term may need to be included or you may need to mathematically transform a predictor/response. In R, we’ll use the simple plot function to compare the model-predicted values to the observed ones.

EXAMPLE PLOT: These two example plots shows evidence for the linearity assumption for each individual predictor. 
1) https://www.ssc.wisc.edu/sscc/pubs/MM/MM_DiagInfer_files/figure-html/unnamed-chunk-4-1.png
2) https://www.ssc.wisc.edu/sscc/pubs/MM/MM_DiagInfer_files/figure-html/unnamed-chunk-5-1.png

RESULTS:

Looks pretty random so we probably haven’t violated this assumption (see Fox 2008 for a discussion about the utility of significance vs visual testing; essentially they argue that significance tests don’t offer you additional information that your naked eye can’t already detect). 

```{r}
# EXAMPLE SCATTER PLOT FOR LINEARITY (THIS IS HOW IT SHOULD LOOK):
Plot.Model.F.Linearity<-plot(Cigarette.Study$Time, resid(Model.F))
Plot.Model.F.Linearity<-plot(Cigarette.Study$BDI, resid(Model.F))
Plot.Model.F.Linearity<-plot(Cigarette.Study$FTND, resid(Model.F))
Plot.Model.F.Linearity<-plot(Cigarette.Study$Time*BDI, resid(Model.F))

# remove rows with missing data 
rel_full <- na.omit(rel2[,c("ATH","AgeW","EducationW","Rel_AttendW","AgeB","Rel_AttendB","PercentageB" )])

# Plot residuals by each predictor
Plot.Model.F.Linearity<-plot(rel_full$AgeW,  (resid(mb3))) #resid() calls for the residuals of the model
Plot.Model.F.Linearity<-plot(rel_full$EducationW, (resid(m3)))
Plot.Model.F.Linearity<-plot(rel_full$Rel_AttendW, (resid(mb3)))
Plot.Model.F.Linearity<-plot(rel_full$AgeB, (resid(mb3)))
Plot.Model.F.Linearity<-plot(rel_full$Rel_AttendB, (resid(mb3)))
Plot.Model.F.Linearity<-plot(rel_full$PercentageB, (resid(mb3)))

```

##### Homoscedasticity

Assumption 2: Homoscedasticity (Homogeneity of Variance)

Regression models assume that variance of the residuals is equal across groups. In this case, the groups we’re referring to are at the individual (i.e. subject) level. How do you test this assumption?

METHOD 1: R is an excellent program for extracting and storing your model residuals. After we have them in place, we can do a simple ANOVA to determine if they’re different for each person. This procedure is a variation of “Levene’s Test”. Essentially, we’ll extract the residuals from the model, place them in our original table, take their absolute value, and then square them (for a more robust analysis with respect to issues of normality, see Glaser 2006). Finally we’ll take a look at the ANOVA of the between subjects residuals (see Hox et al 2018 for reference). Let’s give it a shot below. 

RESULTS: Since the p value is greater than 0.05, we can say that the variance of the residuals is equal and therefore the assumption of homoscedasticity is met.

```{r}
# remove rows with missing data 
rel_full <- na.omit(rel2[,c("Con_No","ATH","AgeW","EducationW","Rel_AttendW","AgeB","Rel_AttendB","PercentageB" )])

# Test homosecdasticity
# For tutorial see: https://ademos.people.uic.edu/Chapter18.html#61_assumption_1_-_linearity
rel_full$resL1 <- residuals(mb3) #extracts the residuals and places them in a new column in our original data table
rel_full$resL1_abs <-abs(rel_full$resL1) #creates a new column with the absolute value of the residuals
rel_full$resL2_abs_sq <- rel_full$resL1_abs^2 #squares the absolute values of the residuals to provide the more robust estimate
mb3_levene <- lm(resL2_abs_sq ~ Con_No , data=rel_full) #ANOVA of the squared residuals
anova(mb3_levene) #displays the results
```

##### Normality

Assumption 3: Normality

Regression models don’t require that outcome variables need to be normally distributed (see: Logistic or Poisson regression models), however MLM assume that the residuals of the analysis ARE normally distributed. How do you test this assumption? QQ plots (quantile-quantile) can provide an estimation of where the standardized residuals lie with respect to normal quantiles. Strong deviation from the provided line indicates that the residuals themselves are not normally distributed.

To test the normality assumption, we can plot standardized residuals against their normal scores with a normal q-q plot. If the residuals have a normal distribution, the plot should show a straight diagonal line. Figure 13.1 is a scatterplot of the standardized first-level residuals, calculated for the final model including cross-level interaction, against their normal scores. 

EXAMPLE PLOT: 
This example plot provide evidence that the normality assumption was met: 
https://www.ssc.wisc.edu/sscc/pubs/MM/MM_DiagInfer_files/figure-html/unnamed-chunk-11-1.png

RESULTS: The graph indicates close conformity to normality, and no extreme outliers. Similar plots can be made for the secondlevel residuals. The residuals should show a nice normal distribution, which implies absence of extreme
outliers.

```{r}

# QQ PLOT FOR MY DATA
lattice::qqmath(m3, id=0.01) #id: identifies values that may be exerting undue influence on the model (i.e. outliers)
```

###### Outliers

Examine outliers by (a) looking at boxplot of L1 and L2 residuals (b) examining z scores for each variable, with a z score greater than |3| indicating an outlier.

RESULTS:

We assessed for outliers be examining standardized residuals at both levels. 

```{r}
# Method 1: 
  # View standardized residuals. Residuals with values above 3 are considered outliers.
  View(residuals(m3, type="pearson"))

# Method 2: Boxplot method to detect outliers
  res_table = as.data.frame(mb3$residuals)
  boxplot(res_table$fixed)
  boxplot(res_table$Con_No)

# Method 3: z scores to detect outliers (more than 3 SD is an outlier)
  # Standardize L1 Variables
    rel2$ATHz <- scale(rel2$ATH, center = TRUE, scale = TRUE)
    rel2$Agez <- scale(rel2$Age, center = TRUE, scale = TRUE)
    rel2$Educationz <- scale(rel2$Education, center = TRUE, scale = TRUE)
    rel2$Rel_Attendz <- scale(rel2$Rel_Attend, center = TRUE, scale = TRUE)
    View(rel2[,c("Con_No","Participant","ATHz","Agez","Educationz","Rel_Attendz", "Rel_Attend")])

  # Standardize L2 Variabes
    # Create Variable for Group Mean
    library(robumeta)
    rel2$ATH_GM <- as.numeric(group.mean(rel2$ATH, rel2$Con_No)) 
    #rel2$Gender_GM <- as.numeric(group.mean(rel2$Gender, rel2$Con_No)) 
    rel2$Age_GM <- as.numeric(group.mean(rel2$Age, rel2$Con_No)) 
    rel2$Education_GM <- as.numeric(group.mean(rel2$Education, rel2$Con_No)) 
    rel2$Rel_Attend_GM <- as.numeric(group.mean(rel2$Rel_Attend, rel2$Con_No)) 
    rel2$Percentage_GM <- as.numeric(group.mean(rel2$Percentage, rel2$Con_No)) 
    # Create new dataset with 1 row per group
    relB <- rel2[!duplicated(rel2$Con_No), ] 
    psych::describe(relB[,c("ATH_GM","Gender_GM","Age_GM","Education_GM","Rel_Attend_GM","Percentage_GM")])
    # Standardize L2 Variables
    relB$ATH_GMz <- scale(relB$ATH_GM, center = TRUE, scale = TRUE)
    relB$Gender_GMz <- scale(relB$Gender_GM, center = TRUE, scale = TRUE)
    relB$Age_GMz <- scale(relB$Age_GM, center = TRUE, scale = TRUE)
    relB$Education_GMz <- scale(relB$Education_GM, center = TRUE, scale = TRUE)
    relB$Rel_Attend_GMz <- scale(relB$Rel_Attend_GM, center = TRUE, scale = TRUE)
    relB$Percentage_GMz <- scale(relB$Percentage_GM, center = TRUE, scale = TRUE)
    View(rel[,c("Con_No","ATH_GMz", "Gender_GMz","Age_GMz", "Education_GMz", "Rel_Attend_GMz", "Percentage_GMz")])


```


### V004

```{r}
# MODEL 1
  m1 <- lmer(ATH ~ 1 + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m1)
  AIC(m1) # request AIC
  BIC(m1) # request BIC
  mb1 <- lme(ATH ~ 1, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb1)
  anova(mb1) # request F-tests for fixed effects
  ranova(m1) # request test of random effects
  confint(m1) # request test of random effects (variance displayed as SD)

# MODEL 2
  m2 <- lmer(ATH ~ GenderW + AgeW + EducationW + Scrip3W + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m2)
  AIC(m2) # request AIC
  BIC(m2) # request BIC
  mb2 <- lme(ATH ~ GenderW + AgeW + EducationW + Scrip3W, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb2)
  anova(m2) # request F-tests for fixed effects
  ranova(m2) # request test of random effects
  confint(m2) # request test of random effects (variance displayed as SD)
  #anova(mb1, mb2)

# MODEL 3
  m3 <- lmer(ATH ~ GenderW + AgeW + EducationW + Scrip3W + GenderB + AgeB + EducationB + Scrip3B + PercentageB + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m3)
  AIC(m3) # request AIC
  BIC(m3) # request BIC
  mb3 <- lme(ATH ~ GenderW + AgeW + EducationW + Scrip3W + GenderB + AgeB + EducationB + Scrip3B + PercentageB, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb3)
  anova(m3) # request F-tests for fixed effects
  ranova(m3) # request test of random effects
  confint(m3) # request test of random effects (variance displayed as SD)
  #anova(m1, m3)
  #anova(m2, m3)  
  
# MODEL 4
  
```
  

    
### V005

```{r}
# MODEL 1
  m1 <- lmer(ATH ~ 1 + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m1)
  AIC(m1) # request AIC
  BIC(m1) # request BIC
  mb1 <- lme(ATH ~ 1, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb1)
  anova(mb1) # request F-tests for fixed effects
  ranova(m1) # request test of random effects
  confint(m1) # request test of random effects (variance displayed as SD)

# MODEL 2
m2 <- lmer(ATH ~ GenderW + AgeW + EducationW + Scrip_ReadW + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m2)
  AIC(m2) # request AIC
  BIC(m2) # request BIC
  mb2 <- lme(ATH ~ GenderW + AgeW + EducationW + Scrip_ReadW, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb2)
  anova(m2) # request F-tests for fixed effects
  ranova(m2) # request test of random effects
  confint(m2) # request test of random effects (variance displayed as SD)
  #anova(mb1, mb2)
  
# MODEL 3  
  m3 <- lmer(ATH ~ GenderW + AgeW + EducationW + Scrip_ReadW + GenderB + AgeB + EducationB + Scrip_ReadB + PercentageB + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m3)
  AIC(m3) # request AIC
  BIC(m3) # request BIC
  mb3 <- lme(ATH ~ GenderW + AgeW + EducationW + Scrip_ReadW + GenderB + AgeB + EducationB + Scrip_ReadB + PercentageB, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb3)
  anova(m3) # request F-tests for fixed effects
  ranova(m3) # request test of random effects
  confint(m3) # request test of random effects (variance displayed as SD)
  #anova(m1, m3)
  #anova(m2, m3)

# For producing APA formatted tables
library(sjPlot) 
tab_model(m1, m2, m3, file="APAtable.doc", show.aic=TRUE, show.dev=TRUE, show.obs=FALSE, p.style="asterisk", show.se=TRUE)  
```

### V006

```{r}
# MODEL 1
  m1 <- lmer(ATH ~ 1 + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m1)
  AIC(m1) # request AIC
  BIC(m1) # request BIC
  mb1 <- lme(ATH ~ 1, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb1)
  anova(mb1) # request F-tests for fixed effects
  ranova(m1) # request test of random effects
  confint(m1) # request test of random effects (variance displayed as SD)

# MODEL 2
m2 <- lmer(ATH_Scaled ~ GenderW + AgeW + EducationW + Rel_AttendW + Scrip_ReadW + Scrip3W + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m2)
  AIC(m2) # request AIC
  BIC(m2) # request BIC
  mb2 <- lme(ATH ~ GenderW + AgeW + EducationW + Rel_AttendW + Scrip_ReadW + Scrip3W, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb2)
  anova(m2) # request F-tests for fixed effects
  ranova(m2) # request test of random effects
  confint(m2) # request test of random effects (variance displayed as SD)
  #anova(mb1, mb2)
  
# MODEL 3
  m3 <- lmer(ATH ~ GenderW + AgeW + EducationW + Rel_AttendW + Scrip_ReadW + Scrip3W + GenderB + AgeB + EducationB + Rel_AttendB + Scrip_ReadB + Scrip3B + PercentageB + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m3)
  AIC(m3) # request AIC
  BIC(m3) # request BIC
  mb3 <- lme(ATH ~ GenderW + AgeW + EducationW + Rel_AttendW + Scrip_ReadW + Scrip3W + GenderB + AgeB + EducationB + Rel_AttendB + Scrip_ReadB + Scrip3B + PercentageB, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb3)
  anova(m3) # request F-tests for fixed effects
  ranova(m3) # request test of random effects
  confint(m3) # request test of random effects (variance displayed as SD)
  #anova(m1, m3)
  #anova(m2, m3)

# For producing APA formatted tables
sjPlot::tab_model(m1, m2, m3, file="APAtable.doc", show.aic=TRUE, show.dev=TRUE, show.obs=FALSE, p.style="asterisk", show.se=TRUE)  
  
```

### V007

```{r}
# MODEL 1
  m1 <- lmer(ATH ~ 1 + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m1)
  AIC(m1) # request AIC
  BIC(m1) # request BIC
  mb1 <- lme(ATH ~ 1, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb1)
  anova(mb1) # request F-tests for fixed effects
  ranova(m1) # request test of random effects
  confint(m1) # request test of random effects (variance displayed as SD)

# MODEL 2
m2 <- lmer(ATH ~ GenderW + AgeW + EducationW + Rel_AttendW + Scrip3W + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m2)
  AIC(m2) # request AIC
  BIC(m2) # request BIC
  mb2 <- lme(ATH ~ GenderW + AgeW + EducationW + Rel_AttendW + Scrip3W, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb2)
  anova(m2) # request F-tests for fixed effects
  ranova(m2) # request test of random effects
  confint(m2) # request test of random effects (variance displayed as SD)
  #anova(mb1, mb2)
  
# MODEL 3
  m3 <- lmer(ATH ~ GenderW + AgeW + EducationW + Rel_AttendW + Scrip3W + GenderB + AgeB + EducationB + Rel_AttendB + Scrip3B + PercentageB + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m3)
  AIC(m3) # request AIC
  BIC(m3) # request BIC
  mb3 <- lme(ATH ~ GenderW + AgeW + EducationW + Rel_AttendW + Scrip3W + GenderB + AgeB + EducationB + Rel_AttendB + Scrip3B + PercentageB, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb3)
  anova(m3) # request F-tests for fixed effects
  ranova(m3) # request test of random effects
  confint(m3) # request test of random effects (variance displayed as SD)
  #anova(m1, m3)
  #anova(m2, m3)

# For producing APA formatted tables
sjPlot::tab_model(m1, m2, m3, file="APAtable.doc", show.aic=TRUE, show.dev=TRUE, show.obs=FALSE, p.style="asterisk", show.se=TRUE)  
      
```
  
### V008

```{r}
# MODEL 1
  m1 <- lmer(ATH ~ 1 + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m1)
  AIC(m1) # request AIC
  BIC(m1) # request BIC
  mb1 <- lme(ATH ~ 1, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb1)
  anova(mb1) # request F-tests for fixed effects
  ranova(m1) # request test of random effects
  confint(m1) # request test of random effects (variance displayed as SD)

# MODEL 2
  m2 <- lmer(ATH ~ GenderW + AgeW + EducationW + Rel_AttendW + Scrip_ReadW + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m2)
  AIC(m2) # request AIC
  BIC(m2) # request BIC
  mb2 <- lme(ATH ~ GenderW + AgeW + EducationW + Rel_AttendW + Scrip_ReadW, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb2)
  anova(m2) # request F-tests for fixed effects
  ranova(m2) # request test of random effects
  confint(m2) # request test of random effects (variance displayed as SD)
  #anova(mb1, mb2)
  
# MODEL 3
  m3 <- lmer(ATH ~ GenderW + AgeW + EducationW + Rel_AttendW + Scrip_ReadW + GenderB + AgeB + EducationB + Rel_AttendB + Scrip_ReadB + PercentageB + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m3)
  AIC(m3) # request AIC
  BIC(m3) # request BIC
  mb3 <- lme(ATH ~ GenderW + AgeW + EducationW + Rel_AttendW + Scrip_ReadW + GenderB + AgeB + EducationB + Rel_AttendB + Scrip_ReadB + PercentageB, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb3)
  anova(m3) # request F-tests for fixed effects
  ranova(m3) # request test of random effects
  confint(m3) # request test of random effects (variance displayed as SD)
  #anova(m1, m3)
  #anova(m2, m3)

# For producing APA formatted tables
sjPlot::tab_model(m1, m2, m3, file="APAtable.doc", show.aic=TRUE, show.dev=TRUE, show.obs=FALSE, p.style="asterisk", show.se=TRUE)  
    
```
  
### V009

```{r}
# MODEL 1
  m1 <- lmer(ATH ~ 1 + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m1)
  AIC(m1) # request AIC
  BIC(m1) # request BIC
  mb1 <- lme(ATH ~ 1, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb1)
  anova(mb1) # request F-tests for fixed effects
  ranova(m1) # request test of random effects
  confint(m1) # request test of random effects (variance displayed as SD)

# MODEL 2
  m2 <- lmer(ATH ~ GenderW + AgeW + EducationW + Scrip3W + Scrip_ReadW + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m2)
  AIC(m2) # request AIC
  BIC(m2) # request BIC
  mb2 <- lme(ATH ~ GenderW + AgeW + EducationW + Scrip3W + Scrip_ReadW, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb2)
  anova(m2) # request F-tests for fixed effects
  ranova(m2) # request test of random effects
  confint(m2) # request test of random effects (variance displayed as SD)
  #anova(mb1, mb2)

# MODEL 3
  m3 <- lmer(ATH ~ GenderW + AgeW + EducationW + Scrip3W + Scrip_ReadW + GenderB + AgeB + EducationB + Scrip3B + Scrip_ReadB + PercentageB + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m3)
  AIC(m3) # request AIC
  BIC(m3) # request BIC
  mb3 <- lme(ATH ~ GenderW + AgeW + EducationW + Scrip3W + Scrip_ReadW + GenderB + AgeB + EducationB + Scrip3B + Scrip_ReadB + PercentageB, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb3)
  anova(m3) # request F-tests for fixed effects
  ranova(m3) # request test of random effects
  confint(m3) # request test of random effects (variance displayed as SD)
  #anova(m1, m3)
  #anova(m2, m3)

# For producing APA formatted tables
sjPlot::tab_model(m1, m2, m3, file="APAtable.doc", show.aic=TRUE, show.dev=TRUE, show.obs=FALSE, p.style="asterisk", show.se=TRUE)  
```
  
### V010

V010 =  Model predicting ATH from all significant correlations between study variables. This includes: Rel_AttendW, Scrip_ReadW, GenderB, EducationB, PercentageB, Rel_AttendB, Scrip_ReadB, Scrip3B


```{r}

# MODEL 1: Empty Model
m1 <- lmer(ATH ~ 1 + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m1)
  AIC(m1) # request AIC
  BIC(m1) # request BIC
mb1 <- lme(ATH ~ 1, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
summary(mb1)
  anova(mb1) # request F-tests for fixed effects
  ranova(m1) # request test of random effects
  confint(m1) # request test of random effects (variance displayed as SD)

# MODEL 2: Add L1 predictors
m2 <- lmer(ATH ~ Rel_AttendW + Scrip_ReadW + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m2)
  AIC(m2) # request AIC
  BIC(m2) # request BIC
mb2 <- lme(ATH ~ Rel_AttendW + Scrip_ReadW, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb2)
  anova(m2) # request F-tests for fixed effects
  ranova(m2) # request test of random effects
  confint(m2) # request test of random effects (variance displayed as SD)
  #anova(mb1, mb2)
  
# MODEL 3: Add L2 Predictors
m3 <- lmer(ATH ~ Rel_AttendW + Scrip_ReadW + GenderB + EducationB + PercentageB + Rel_AttendB + Scrip_ReadB + Scrip3B + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m3)
  AIC(m3) # request AIC
  BIC(m3) # request BIC

mb3 <- lme(ATH ~ Rel_AttendW + Scrip_ReadW + GenderB + EducationB + PercentageB + Rel_AttendB + Scrip_ReadB + Scrip3B, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb3)
  anova(m3) # request F-tests for fixed effects
  ranova(m3) # request test of random effects
  confint(m3) # request test of random effects (variance displayed as SD
  #anova(m1, m3)
  #anova(m2, m3)

# Create PA formatted tables
sjPlot::tab_model(m1, m2, m3, file="APAtable.doc", show.aic=TRUE, show.dev=TRUE, show.obs=FALSE, p.style="asterisk", show.se=TRUE)
```
 
### V011

V011 =  Model predicting ATH from all significant correlations between study variables (except scripture interpretation). This includes: Rel_AttendW, Scrip_ReadW, GenderB, EducationB, PercentageB, Rel_AttendB, Scrip_ReadB.

RESULTS:


```{r}

# MODEL 1: Empty Model
m1 <- lmer(ATH ~ 1 + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m1)
  AIC(m1) # request AIC
  BIC(m1) # request BIC
mb1 <- lme(ATH ~ 1, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
summary(mb1)
  anova(mb1) # request F-tests for fixed effects
  ranova(m1) # request test of random effects
  confint(m1) # request test of random effects (variance displayed as SD)

# MODEL 2: Add L1 predictors
m2 <- lmer(ATH ~ Rel_AttendW + Scrip_ReadW + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m2)
  AIC(m2) # request AIC
  BIC(m2) # request BIC
mb2 <- lme(ATH ~ Rel_AttendW + Scrip_ReadW, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb2)
  anova(m2) # request F-tests for fixed effects
  ranova(m2) # request test of random effects
  confint(m2) # request test of random effects (variance displayed as SD)
  #anova(mb1, mb2)
  
# MODEL 3: Add L2 Predictors
m3 <- lmer(ATH ~ Rel_AttendW + Scrip_ReadW + GenderB + EducationB + PercentageB + Rel_AttendB + Scrip_ReadB + (1 | Con_No), REML=FALSE, data = rel2)
  summary(m3)
  AIC(m3) # request AIC
  BIC(m3) # request BIC

mb3 <- lme(ATH ~ Rel_AttendW + Scrip_ReadW + GenderB + EducationB + PercentageB + Rel_AttendB + Scrip_ReadB, random = ~ 1|Con_No, method="ML", na.action = na.omit, data = rel2)
  summary(mb3)
  anova(m3) # request F-tests for fixed effects
  ranova(m3) # request test of random effects
  confint(m3) # request test of random effects (variance displayed as SD
  #anova(m1, m3)
  #anova(m2, m3)

# Create PA formatted tables
sjPlot::tab_model(m1, m2, m3, file="APAtable.doc", show.aic=TRUE, show.dev=TRUE, show.obs=FALSE, p.style="asterisk", show.se=TRUE)

# Clear all objects in R workspace
rm(list=ls())
``` 
 
  
## -----

